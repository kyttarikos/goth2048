<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>2048 â€” Gothic Edition</title>
<style>
  :root{
    --bg:#0f0f0f;
    --board:#1a1a1a;
    --tile-empty:#262626;
    --text-light:#f2f2f2;
    --accent:#8b0000;
    --tile-size:90px;
    --gap:15px;
    --radius:6px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: "Cinzel", serif;
    background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
    display:flex;
    align-items:center;
    justify-content:center;
    color:var(--text-light);
    padding:20px;
  }

  .game {
    width:calc(4*var(--tile-size) + 3*var(--gap) + 40px);
    max-width:98vw;
  }

  .header {
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin-bottom:16px;
  }
  .title{
    font-weight:700;
    font-size:26px;
    letter-spacing:2px;
    text-shadow: 0 0 6px #8b0000;
  }
  .controls{
    display:flex;
    gap:8px;
    align-items:center;
  }
  .score {
    background:var(--board);
    color:var(--accent);
    border-radius:6px;
    padding:8px 12px;
    min-width:72px;
    text-align:center;
    font-weight:700;
    box-shadow: 0 0 8px rgba(139,0,0,0.5);
  }
  .small{font-size:12px;opacity:.8}

  .board-wrap{
    background:var(--board);
    border-radius:var(--radius);
    padding:20px;
    position:relative;
    user-select:none;
    touch-action: none;
    box-shadow: inset 0 0 20px #000, 0 0 10px #8b0000;
  }

  .board {
    width:calc(4*var(--tile-size) + 3*var(--gap));
    height:calc(4*var(--tile-size) + 3*var(--gap));
    display:grid;
    grid-template-columns:repeat(4, var(--tile-size));
    grid-template-rows:repeat(4, var(--tile-size));
    gap:var(--gap);
    position:relative;
  }

  .cell {
    background:var(--tile-empty);
    border-radius:4px;
  }

  .tiles {
    position:absolute;
    left:20px;
    top:20px;
    width:calc(4*var(--tile-size) + 3*var(--gap));
    height:calc(4*var(--tile-size) + 3*var(--gap));
    pointer-events:none;
  }

  .tile {
    position:absolute;
    width:var(--tile-size);
    height:var(--tile-size);
    border-radius:4px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:800;
    font-size:26px;
    transition: transform 150ms ease, opacity 120ms ease;
    will-change: transform;
    font-family: "Cinzel", serif;
    box-shadow: 0 0 8px rgba(0,0,0,0.6);
  }

  .tile.new {
    transform: scale(.1);
    animation:pop .12s ease forwards;
  }
  @keyframes pop { to { transform: scale(1); } }

  /* Gothic tile palette */
  .t-2{background:#2c2c2c;color:#ccc}
  .t-4{background:#3b3b3b;color:#ccc}
  .t-8{background:#5c0a0a;color:#f2f2f2}
  .t-16{background:#7a0f0f;color:#f2f2f2}
  .t-32{background:#8b0000;color:#f2f2f2}
  .t-64{background:#b22222;color:#f2f2f2}
  .t-128{background:#8b1a1a;color:#f2f2f2;font-size:20px}
  .t-256{background:#660000;color:#f2f2f2;font-size:20px}
  .t-512{background:#4b0000;color:#f2f2f2;font-size:20px}
  .t-1024{background:#2e0000;color:#f2f2f2;font-size:18px}
  .t-2048{background:#000;color:#8b0000;font-size:18px;border:2px solid #8b0000}

  .overlay {
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:40;
    background:rgba(0,0,0,0.75);
    border-radius:var(--radius);
    font-size:28px;
    font-weight:700;
    color:var(--accent);
    flex-direction:column;
    gap:10px;
    text-shadow: 0 0 6px #8b0000;
  }

  .hidden{display:none}
  .btn {
    background:var(--accent);
    color:white;
    padding:8px 12px;
    border-radius:6px;
    border:none;
    cursor:pointer;
    font-weight:700;
    font-family: "Cinzel", serif;
    box-shadow: 0 0 6px rgba(139,0,0,0.6);
  }
  footer{margin-top:12px;font-size:12px;text-align:center;color:#777}
  @media (max-width:420px){
    :root{--tile-size:68px;--gap:12px}
    .title{font-size:20px}
  }
</style>
</head>
<body>
  <div class="game" id="game">
    <div class="header">
      <div>
        <div class="title">2048: Gothic</div>
        <div class="small">WASD / Arrows / Swipe</div>
      </div>
      <div class="controls">
        <div class="score" id="scoreBox"><div id="score">0</div><div class="small">SCORE</div></div>
        <button id="newBtn" class="btn">New Game</button>
      </div>
    </div>

    <div class="board-wrap" id="boardWrap">
      <div class="board" id="board"></div>
      <div class="tiles" id="tiles"></div>

      <div class="overlay hidden" id="overlay">
        <div id="overlayText">You Win!</div>
        <div>
          <button class="btn" id="overlayContinue">Keep Going</button>
          <button class="btn" id="overlayRestart">Restart</button>
        </div>
      </div>
    </div>
    <footer>Dark mode never looked so good.</footer>
  </div>

<script>
const SIZE = 4;
let grid = [];
let score = 0;
let gameOver = false;
let gameWon = false;

const board = document.getElementById('board');
const tilesContainer = document.getElementById('tiles');
const scoreBox = document.getElementById('score');
const overlay = document.getElementById('overlay');
const overlayText = document.getElementById('overlayText');

function makeCells(){
  board.innerHTML = '';
  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      const cell = document.createElement('div');
      cell.className = 'cell';
      board.appendChild(cell);
    }
  }
}

function init(){
  makeCells();
  grid = Array.from({length:SIZE}, ()=> Array(SIZE).fill(0));
  score = 0;
  gameOver=false;
  gameWon=false;
  updateScore();
  tilesContainer.innerHTML = '';
  overlay.classList.add('hidden');
  addRandomTile();
  addRandomTile();
  render();
}

function updateScore(){ scoreBox.textContent = score; }

function addRandomTile(){
  const empties = [];
  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      if(grid[r][c]===0) empties.push([r,c]);
    }
  }
  if(empties.length===0) return false;
  const [r,c] = empties[Math.floor(Math.random()*empties.length)];
  grid[r][c] = Math.random() < 0.9 ? 2 : 4;
  return {r,c};
}

function render(){
  tilesContainer.innerHTML = '';
  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      const val = grid[r][c];
      if(val!==0) createTile(r,c,val);
    }
  }
  if(checkGameOver()){
    showOverlay('Game Over');
    gameOver = true;
  }
  if(!gameWon && has2048()){
    gameWon = true;
    showOverlay('You Win!');
  }
}

function createTile(r,c,val,opts={}){
  const t = document.createElement('div');
  t.className = 'tile t-' + val;
  t.style.transform = positionToTransform(r,c);
  t.textContent = val;
  if(opts.isNew) t.classList.add('new');
  tilesContainer.appendChild(t);
}

function positionToTransform(r,c){
  const size = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--tile-size')) || 90;
  const gap = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--gap')) || 15;
  return `translate(${c * (size + gap)}px, ${r * (size + gap)}px)`;
}

function slideArray(arr){
  let moved=false;
  let newArr = arr.filter(v=>v!==0);
  for(let i=0;i<newArr.length-1;i++){
    if(newArr[i]===newArr[i+1]){
      newArr[i] *= 2;
      score += newArr[i];
      newArr.splice(i+1,1);
      moved = true;
    }
  }
  while(newArr.length < SIZE) newArr.push(0);
  for(let i=0;i<SIZE;i++){
    if(arr[i] !== newArr[i]) { moved = true; break; }
  }
  return {arr:newArr, moved};
}

function move(direction){
  if(gameOver) return false;
  let movedAny=false;
  if(direction === 'left' || direction === 'right'){
    for(let r=0;r<SIZE;r++){
      let row = grid[r].slice();
      if(direction === 'right') row.reverse();
      const res = slideArray(row);
      let newRow = res.arr;
      if(direction === 'right') newRow.reverse();
      for(let c=0;c<SIZE;c++) grid[r][c] = newRow[c];
      if(res.moved) movedAny = true;
    }
  } else {
    for(let c=0;c<SIZE;c++){
      let col = [];
      for(let r=0;r<SIZE;r++) col.push(grid[r][c]);
      if(direction === 'down') col.reverse();
      const res = slideArray(col);
      let newCol = res.arr;
      if(direction === 'down') newCol.reverse();
      for(let r=0;r<SIZE;r++) grid[r][c] = newCol[r];
      if(res.moved) movedAny = true;
    }
  }
  if(movedAny){
    updateScore();
    addRandomTile();
    render();
    return true;
  }
  return false;
}

function hasMoves(){
  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      if(grid[r][c]===0) return true;
      const v = grid[r][c];
      if(c+1<SIZE && grid[r][c+1]===v) return true;
      if(r+1<SIZE && grid[r+1][c]===v) return true;
    }
  }
  return false;
}

function checkGameOver(){
  if(has2048()) return false;
  return !hasMoves();
}

function has2048(){
  return grid.some(row=>row.includes(2048));
}

function showOverlay(text){
  overlayText.textContent = text;
  overlay.classList.remove('hidden');
}

document.getElementById('newBtn').addEventListener('click', ()=>init());
document.getElementById('overlayRestart').addEventListener('click', ()=>init());
document.getElementById('overlayContinue').addEventListener('click', ()=>overlay.classList.add('hidden'));

window.addEventListener('keydown', (e)=>{
  if(gameOver) return;
  const key = e.key;
  if(key === 'ArrowUp' || key === 'w' || key === 'W') move('up');
  else if(key === 'ArrowDown' || key === 's' || key === 'S') move('down');
  else if(key === 'ArrowLeft' || key === 'a' || key === 'A') move('left');
  else if(key === 'ArrowRight' || key === 'd' || key === 'D') move('right');
});

(function addTouchControls(){
  const wrap = document.getElementById('boardWrap');
  let startX=0, startY=0;
  wrap.addEventListener('touchstart', e=>{
    if(e.touches.length>1) return;
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
  }, {passive:true});
  wrap.addEventListener('touchend', e=>{
    const dx = e.changedTouches[0].clientX - startX;
    const dy = e.changedTouches[0].clientY - startY;
    if(Math.abs(dx) > Math.abs(dy)){
      dx>0 ? move('right') : move('left');
    } else {
      dy>0 ? move('down') : move('up');
    }
  }, {passive:true});
})();

init();
</script>
</body>
</html>
